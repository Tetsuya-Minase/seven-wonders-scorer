import{b as E,c as f,e as B,f as I,i as w,k as N,m as _,q as D,t as L,u as M}from"./chunk-MNJPSXG7.js";import{A as n,C as d,D as b,H as l,K as s,N as o,O as r,P as c,R as h,S as x,T as a,V as p,X as g,ca as C,ea as F,fa as S,ia as y,t as v}from"./chunk-DDZYSYSB.js";var k=(t,m)=>({"border-red-500":t,"border-gray-300":m});function R(t,m){t&1&&(o(0,"div",14),a(1," \u30EB\u30FC\u30E0\u540D\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044 "),r())}function j(t,m){t&1&&(o(0,"div",14),a(1," \u30E6\u30FC\u30B6\u30FC\u540D\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044 "),r())}function A(t,m){if(t&1&&(o(0,"div",15),a(1),r()),t&2){let i=x();n(),p(" ",i.errorMessage," ")}}function T(t,m){t&1&&(o(0,"span",16),v(),o(1,"svg",17),c(2,"circle",18)(3,"path",19),r()())}var Q=(()=>{class t{constructor(i,u,e){this.router=i,this.formBuilder=u,this.webSocketService=e,this.formSubmitted=!1,this.isLoading=!1,this.errorMessage="",this.subscription=null,this.loginForm=this.formBuilder.group({roomName:["",f.required],username:["",f.required]}),this.webSocketService.connect()}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}login(){if(this.formSubmitted=!0,this.errorMessage="",this.loginForm.invalid)return;let i=this.loginForm.get("roomName")?.value,u=this.loginForm.get("username")?.value;this.isLoading=!0,this.subscription=this.webSocketService.joinRoom(i,u).subscribe({next:e=>{if(e.error){this.errorMessage=e.error,this.isLoading=!1;return}localStorage.setItem("roomName",i),localStorage.setItem("username",u),this.router.navigate(["/score"])},error:e=>{console.error("\u30EB\u30FC\u30E0\u53C2\u52A0\u30A8\u30E9\u30FC:",e),this.errorMessage="\u30B5\u30FC\u30D0\u30FC\u306B\u63A5\u7D9A\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002\u5F8C\u3067\u3082\u3046\u4E00\u5EA6\u304A\u8A66\u3057\u304F\u3060\u3055\u3044\u3002",this.isLoading=!1}})}get isRoomNameInvalid(){let i=this.loginForm.get("roomName");return i?i.invalid&&this.formSubmitted:!1}get isUsernameInvalid(){let i=this.loginForm.get("username");return i?i.invalid&&this.formSubmitted:!1}static{this.\u0275fac=function(u){return new(u||t)(d(y),d(D),d(M))}}static{this.\u0275cmp=b({type:t,selectors:[["seven-wonders-scorer-login"]],decls:22,vars:17,consts:[[1,"flex","flex-col","items-center","justify-center","min-h-[70vh]","p-4"],[1,"w-full","max-w-md","p-6","bg-white","rounded-lg","shadow-md"],[1,"text-text_black","text-2xl","font-bold","text-center","mb-6"],[1,"space-y-4",3,"ngSubmit","formGroup"],[1,"space-y-1"],["for","roomName",1,"block","text-sm","font-medium","text-gray-700"],["id","roomName","type","text","formControlName","roomName","placeholder","\u30EB\u30FC\u30E0\u540D\u3092\u5165\u529B",1,"w-full","px-3","py-2","border","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500","placeholder:text-gray-400",3,"ngClass","disabled"],["class","text-red-500 text-sm mt-1",4,"ngIf"],["for","username",1,"block","text-sm","font-medium","text-gray-700"],["id","username","type","text","formControlName","username","placeholder","\u30E6\u30FC\u30B6\u30FC\u540D\u3092\u5165\u529B",1,"w-full","px-3","py-2","border","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500","placeholder:text-gray-400",3,"ngClass","disabled"],["class","text-red-500 text-sm p-2 bg-red-50 rounded-md",4,"ngIf"],["type","submit",1,"w-full","py-2","px-4","bg-blue-600","hover:bg-blue-700","text-white","font-bold","rounded-md","transition","duration-200","flex","items-center","justify-center",3,"disabled"],["class","mr-2",4,"ngIf"],[1,"mt-4","text-sm","text-gray-600","text-center"],[1,"text-red-500","text-sm","mt-1"],[1,"text-red-500","text-sm","p-2","bg-red-50","rounded-md"],[1,"mr-2"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","h-5","w-5","text-white"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"]],template:function(u,e){u&1&&(o(0,"div",0)(1,"div",1)(2,"h2",2),a(3,"7 Wonders Scorer - \u30ED\u30B0\u30A4\u30F3"),r(),o(4,"form",3),h("ngSubmit",function(){return e.login()}),o(5,"div",4)(6,"label",5),a(7,"\u30EB\u30FC\u30E0\u540D"),r(),c(8,"input",6),l(9,R,2,0,"div",7),r(),o(10,"div",4)(11,"label",8),a(12,"\u30E6\u30FC\u30B6\u30FC\u540D"),r(),c(13,"input",9),l(14,j,2,0,"div",7),r(),l(15,A,2,1,"div",10),o(16,"button",11),l(17,T,4,0,"span",12),a(18),r()(),o(19,"div",13)(20,"p"),a(21,"\u540C\u3058\u30EB\u30FC\u30E0\u540D\u3092\u5165\u529B\u3057\u305F\u30E6\u30FC\u30B6\u30FC\u540C\u58EB\u304C\u540C\u3058\u30C7\u30FC\u30BF\u3092\u95B2\u89A7\u3067\u304D\u307E\u3059"),r()()()()),u&2&&(n(4),s("formGroup",e.loginForm),n(4),s("ngClass",g(11,k,e.isRoomNameInvalid,!e.isRoomNameInvalid))("disabled",e.isLoading),n(),s("ngIf",e.isRoomNameInvalid),n(4),s("ngClass",g(14,k,e.isUsernameInvalid,!e.isUsernameInvalid))("disabled",e.isLoading),n(),s("ngIf",e.isUsernameInvalid),n(),s("ngIf",e.errorMessage),n(),s("disabled",e.isLoading),n(),s("ngIf",e.isLoading),n(),p(" ",e.isLoading?"\u30ED\u30B0\u30A4\u30F3\u4E2D...":"\u30ED\u30B0\u30A4\u30F3"," "))},dependencies:[S,C,F,L,w,E,B,I,N,_],encapsulation:2})}}return t})();export{Q as LoginComponent};

import{a as ee,b as d,c as N,d as I,e as re,f as j,g as T,h as oe,i as U,j as te,l as B,m as D,n as _}from"./chunk-2BMQNNRB.js";import{$ as P,A as i,C as p,D as S,H as O,J as H,K as a,M as E,N as s,O as n,P as b,Q as J,R as u,S as K,T as l,U as V,V as v,X as L,a as h,b as y,ba as Q,ca as X,da as Y,ea as f,ha as Z,l as F,o as w,q as G,r as W,s as q,v as A,w as M,x as z,z as $}from"./chunk-XJQMVOXP.js";var se=(()=>{class t{#e=$(null);constructor(o){this.webSocketService=o,this.webSocketService.getRoomData().subscribe(c=>{c&&this.#e.set(c)});let e=localStorage.getItem("roomName"),r=localStorage.getItem("username");e&&r&&this.webSocketService.joinRoom(e,r).subscribe({next:c=>{if(c.error){console.error("\u30EB\u30FC\u30E0\u53C2\u52A0\u30A8\u30E9\u30FC:",c.error);return}console.log("\u30EB\u30FC\u30E0\u53C2\u52A0\u6210\u529F:",c)},error:c=>{console.error("\u30EB\u30FC\u30E0\u53C2\u52A0\u30A8\u30E9\u30FC:",c)}})}asReadonly(){return this.#e.asReadonly()}getScores(){let o=this.#e();return!o||!o.scores?[]:Object.values(o.scores).map(e=>{let c=Math.min(e.scienceScore.compass,e.scienceScore.gear,e.scienceScore.tablet)*7+(e.scienceScore.gear>0?e.scienceScore.gear*e.scienceScore.gear:0)+(e.scienceScore.compass>0?e.scienceScore.compass*e.scienceScore.compass:0)+(e.scienceScore.tablet>0?e.scienceScore.tablet*e.scienceScore.tablet:0),m=Object.values(e).reduce((k,g)=>g==null?k:typeof g=="number"?k+g:typeof g=="object"&&"gear"in g&&"compass"in g&&"tablet"in g?k+c:k,0);return y(h({},e),{scienceScore:y(h({},e.scienceScore),{sum:c}),sum:m})})}addUser(o){this.webSocketService.addUser(o).subscribe({next:e=>{if(e.error){console.error("\u30E6\u30FC\u30B6\u30FC\u8FFD\u52A0\u30A8\u30E9\u30FC:",e.error);return}console.log("\u30E6\u30FC\u30B6\u30FC\u8FFD\u52A0\u6210\u529F:",e)},error:e=>{console.error("\u30E6\u30FC\u30B6\u30FC\u8FFD\u52A0\u30A8\u30E9\u30FC:",e)}})}updateScore(o,e){this.webSocketService.updateScore(o,e).subscribe({next:r=>{if(r.error){console.error("\u30B9\u30B3\u30A2\u66F4\u65B0\u30A8\u30E9\u30FC:",r.error);return}console.log("\u30B9\u30B3\u30A2\u66F4\u65B0\u6210\u529F:",r)},error:r=>{console.error("\u30B9\u30B3\u30A2\u66F4\u65B0\u30A8\u30E9\u30FC:",r)}})}static{this.\u0275fac=function(e){return new(e||t)(w(_))}}static{this.\u0275prov=F({token:t,factory:t.\u0275fac})}}return t})();var R=(()=>{class t{#e;constructor(o,e){this.roomState=o,this.webSocketService=e,this.#e=o.asReadonly()}joinRoom(o,e){return this.webSocketService.joinRoom(o,e)}addUser(o){this.roomState.addUser(o)}updateScore(o,e){this.roomState.updateScore(o,e)}getScores(){return this.roomState.getScores()}getScoreByUsername(o){return this.roomState.getScores().find(r=>r.username===o)}static{this.\u0275fac=function(e){return new(e||t)(w(se),w(_))}}static{this.\u0275prov=F({token:t,factory:t.\u0275fac})}}return t})();var ne=(()=>{class t{constructor(){this.score=0,this.label="",this.bgClass=""}ngOnInit(){switch(this.scoreType){case"civilization":this.label="civilizationScore",this.bgClass="bg-bg_civilization_score";break;case"military":this.label="militaryScore",this.bgClass="bg-bg_military_score";break;case"science":this.label="scienceScore",this.bgClass="bg-bg_science_score";break;case"commercial":this.label="commercialScore",this.bgClass="bg-bg_commercial_score";break;case"guild":this.label="guildScore",this.bgClass="bg-bg_guild_score";break;case"city":this.label="cityScore",this.bgClass="bg-bg_city_score";break;case"leader":this.label="leaderScore",this.bgClass="bg-bg_leader_score";break;case"coin":this.label="coinScore",this.bgClass="bg-bg_coin_score";break;case"wonder":this.label="wonderScore",this.bgClass="bg-bg_wonder_score";break;default:{let o=this.scoreType;throw new Error(`Unknown scoreType: ${o}`)}}}static{this.\u0275fac=function(e){return new(e||t)}}static{this.\u0275cmp=S({type:t,selectors:[["seven-wonders-scorer-score-item"]],inputs:{score:"score",scoreType:"scoreType"},decls:6,vars:4,consts:[[1,"w-fit"],[1,"hidden"],[1,"flex","items-center","justify-center","w-16","desktop:w-20","h-16","desktop:h-20","text-text_black","text-2xl","desktop:text-4xl","bg-white","border","border-solid","border-white","rounded-full"]],template:function(e,r){e&1&&(s(0,"div",0)(1,"dt",1),l(2),n(),s(3,"dd")(4,"span",2),l(5),n()()()),e&2&&(i(2),V(r.label),i(),E("flex items-center justify-center w-20 desktop:w-24 h-20 desktop:h-24 border border-solid border-border_black rounded-full "+r.bgClass),i(2),V(r.score))},dependencies:[f],encapsulation:2})}}return t})();var ae=(()=>{class t{constructor(){this.openModalEvent=new M}#e;#r;ngOnInit(){this.#r=this.score.username,this.#e=!1}ngOnChanges(o){if("score"in o&&o.score.currentValue==null)throw new Error("score is required.")}openModal(){this.openModalEvent.emit(this.username)}get showModal(){return!!this.#e}get username(){return this.#r||""}static{this.\u0275fac=function(e){return new(e||t)}}static{this.\u0275cmp=S({type:t,selectors:[["seven-wonders-scorer-user-card"]],inputs:{score:"score"},outputs:{openModalEvent:"openModalEvent"},features:[G],decls:19,vars:13,consts:[[1,"relative","grid","grid-cols-[auto_1fr]","border","border-solid","border-border_black","rounded","p-2","desktop:py-3","desktop:px-4","max-w-xl","hover:bg-gray-100","transition-colors"],[1,"flex","flex-col","items-center","flex-none"],[1,"order-2","font-bold","text-text_black","text-2xl","desktop:text-4xl"],[1,"order-1","flex","items-center","justify-center","w-20","desktop:w-28","h-20","desktop:h-28","border","border-solid","border-border_black","rounded-full","text-text_black","text-2xl","desktop:text-4xl"],[1,"grid","grid-cols-[repeat(auto-fit,_minmax(80px,_1fr))]","desktop:grid-cols-[repeat(auto-fit,_minmax(96px,_1fr))]","gap-2","desktop:gap-4","ml-2","desktop:ml-4"],["scoreType","civilization",3,"score"],["scoreType","military",3,"score"],["scoreType","science",3,"score"],["scoreType","commercial",3,"score"],["scoreType","guild",3,"score"],["scoreType","city",3,"score"],["scoreType","leader",3,"score"],["scoreType","coin",3,"score"],["scoreType","wonder",3,"score"],[1,"absolute","inset-0","w-full","h-full","opacity-0","cursor-pointer","focus:opacity-20","focus:bg-blue-200","focus:outline-none",3,"click"],[1,"sr-only"]],template:function(e,r){e&1&&(s(0,"section",0)(1,"div",1)(2,"h2",2),l(3),n(),s(4,"div",3),l(5),n()(),s(6,"dl",4),b(7,"seven-wonders-scorer-score-item",5)(8,"seven-wonders-scorer-score-item",6)(9,"seven-wonders-scorer-score-item",7)(10,"seven-wonders-scorer-score-item",8)(11,"seven-wonders-scorer-score-item",9)(12,"seven-wonders-scorer-score-item",10)(13,"seven-wonders-scorer-score-item",11)(14,"seven-wonders-scorer-score-item",12)(15,"seven-wonders-scorer-score-item",13),n(),s(16,"button",14),u("click",function(){return r.openModal()}),s(17,"span",15),l(18),n()()()),e&2&&(i(3),v(" ",r.score.username," "),i(2),v(" ",r.score.sum," "),i(2),a("score",r.score.civilScore),i(),a("score",r.score.militaryScore),i(),a("score",r.score.scienceScore.sum),i(),a("score",r.score.commercialScore),i(),a("score",r.score.guildScore),i(),a("score",r.score.cityScore),i(),a("score",r.score.leaderScore),i(),a("score",r.score.coinScore),i(),a("score",r.score.wonderScore),i(),H("aria-label","Edit scores for "+r.score.username),i(2),v("Edit scores for ",r.score.username,""))},dependencies:[f,ne],encapsulation:2})}}return t})();var le=(()=>{class t{constructor(o,e,r){this.roomService=o,this.formBuilder=e,this.destroyRef=r,this.closeModalEvent=new M,this.username=z.required({alias:"username"}),this.showModal=z.required({alias:"showModal"}),this.FormControl=re,this.updateScoreForm=this.formBuilder.group({username:["",[d.required]],civilizationScore:[0,[d.min(0)]],militaryScore:[0,[d.min(0)]],scienceScore:this.formBuilder.group({gear:[0,[d.min(0)]],compass:[0,[d.min(0)]],tablet:[0,[d.min(0)]]}),commercialScore:[0,[d.min(0)]],guildScore:[0,[d.min(0)]],cityScore:[0,[d.min(0)]],leaderScore:[0,[d.min(0)]],coinScore:[0,[d.min(0)]],wonderScore:[0,[d.min(0)]]}),P(()=>{console.log("username: ",this.username()),this.updateScoreForm.patchValue({username:this.username()});let c=this.username();if(c){let m=this.roomService.getScoreByUsername(c);m&&this.updateScoreForm.patchValue({civilizationScore:m.civilScore,militaryScore:m.militaryScore,scienceScore:{gear:m.scienceScore.gear,compass:m.scienceScore.compass,tablet:m.scienceScore.tablet},commercialScore:m.commercialScore,guildScore:m.guildScore,cityScore:m.cityScore,leaderScore:m.leaderScore,coinScore:m.coinScore,wonderScore:m.wonderScore})}})}closeModal(){this.closeModalEvent.emit()}updateScore(){if(!this.updateScoreForm.valid)throw new Error("updateScoreForm is invalid");this.roomService.updateScore(this.updateScoreForm.controls.username.value,{civilScore:this.updateScoreForm.controls.civilizationScore.value,militaryScore:this.updateScoreForm.controls.militaryScore.value,scienceScore:{gear:this.updateScoreForm.controls.scienceScore.controls.gear.value,compass:this.updateScoreForm.controls.scienceScore.controls.compass.value,tablet:this.updateScoreForm.controls.scienceScore.controls.tablet.value},commercialScore:this.updateScoreForm.controls.commercialScore.value,guildScore:this.updateScoreForm.controls.guildScore.value,cityScore:this.updateScoreForm.controls.cityScore.value,leaderScore:this.updateScoreForm.controls.leaderScore.value,coinScore:this.updateScoreForm.controls.coinScore.value,wonderScore:this.updateScoreForm.controls.wonderScore.value}),this.closeModal()}static{this.\u0275fac=function(e){return new(e||t)(p(R),p(B),p(A))}}static{this.\u0275cmp=S({type:t,selectors:[["seven-wonders-scorer-score-update-modal"]],inputs:{username:[1,"username"],showModal:[1,"showModal"]},outputs:{closeModalEvent:"closeModalEvent"},decls:29,vars:4,consts:[["aria-labelledby","modal-title","role","dialog","aria-modal","true"],[1,"fixed","inset-0","bg-gray-500","bg-opacity-75","transition-opacity"],[1,"fixed","inset-0","z-10","w-screen","overflow-y-auto"],[1,"flex","min-h-full","justify-center","p-4","text-center","sm:items-center","sm:p-0"],[1,"relative","transform","overflow-hidden","rounded-lg","bg-white","px-3","pb-3","pt-4","text-left","shadow-xl","transition-all","sm:my-8","sm:w-full","sm:max-w-xl","smartphone:max-w-3xl","desktop:max-w-4xl","sm:p-6"],[3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","gap-2","smartphone:grid-cols-3","smartphone:gap-2","desktop:grid-cols-4","desktop:gap-3"],["type","civilization","formControlName","civilizationScore","borderColorClass","border-br_civilization_score focus:ring-br_civilization_score"],["type","military","formControlName","militaryScore","borderColorClass","border-br_military_score focus:ring-br_military_score"],["type","commercial","formControlName","commercialScore","borderColorClass","border-br_commercial_score focus:ring-br_commercial_score"],["type","guild","formControlName","guildScore","borderColorClass","border-br_guild_score focus:ring-br_guild_score"],["type","city","formControlName","cityScore","borderColorClass","border-br_city_score focus:ring-br_city_score"],["type","leader","formControlName","leaderScore","borderColorClass","border-br_leader_score focus:ring-br_leader_score"],["type","coin","formControlName","coinScore","borderColorClass","border-br_coin_score focus:ring-br_coin_score"],["type","wonder","formControlName","wonderScore","borderColorClass","border-br_wonder_score focus:ring-br_wonder_score"],["formGroupName","scienceScore",1,"mt-4"],[1,"mb-2"],[1,"grid","grid-cols-1","gap-2","smartphone:grid-cols-3","smartphone:gap-2","desktop:grid-cols-3","desktop:gap-3"],["type","compass","formControlName","compass","borderColorClass","border-br_science_score focus:ring-br_science_score"],["type","gear","formControlName","gear","borderColorClass","border-br_science_score focus:ring-br_science_score"],["type","tablet","formControlName","tablet","borderColorClass","border-br_science_score focus:ring-br_science_score"],[1,"mt-4"],["type","submit",1,"inline-flex","w-full","justify-center","rounded-md","bg-green-600","px-3","py-2","text-sm","font-semibold","text-white","shadow-sm","hover:bg-green-500","focus-visible:outline","focus-visible:outline-2","focus-visible:outline-offset-2","focus-visible:outline-green-600",3,"disabled"],[1,"mt-5","sm:mt-6"],["type","button",1,"inline-flex","w-full","justify-center","rounded-md","bg-indigo-600","px-3","py-2","text-sm","font-semibold","text-white","shadow-sm","hover:bg-indigo-500","focus-visible:outline","focus-visible:outline-2","focus-visible:outline-offset-2","focus-visible:outline-indigo-600",3,"click"]],template:function(e,r){e&1&&(s(0,"div",0),b(1,"div",1),s(2,"div",2)(3,"div",3)(4,"div",4)(5,"div")(6,"form",5),u("ngSubmit",function(){return r.updateScore()}),s(7,"div",6),b(8,"seven-wonders-scorer-score-input-form",7)(9,"seven-wonders-scorer-score-input-form",8)(10,"seven-wonders-scorer-score-input-form",9)(11,"seven-wonders-scorer-score-input-form",10)(12,"seven-wonders-scorer-score-input-form",11)(13,"seven-wonders-scorer-score-input-form",12)(14,"seven-wonders-scorer-score-input-form",13)(15,"seven-wonders-scorer-score-input-form",14),n(),s(16,"div",15)(17,"h3",16),l(18,"\u79D1\u5B66\u30B9\u30B3\u30A2"),n(),s(19,"div",17),b(20,"seven-wonders-scorer-score-input-form",18)(21,"seven-wonders-scorer-score-input-form",19)(22,"seven-wonders-scorer-score-input-form",20),n()(),s(23,"div",21)(24,"button",22),l(25," \u767B\u9332 "),n()()()(),s(26,"div",23)(27,"button",24),u("click",function(){return r.closeModal()}),l(28," \u9589\u3058\u308B "),n()()()()()()),e&2&&(E("relative z-10 "+(r.showModal()?"":"hidden")),i(6),a("formGroup",r.updateScoreForm),i(18),a("disabled",!r.updateScoreForm.valid))},dependencies:[f,D,j,N,I,T,U,oe],encapsulation:2})}}return t})();var ue=(t,x)=>({"border-red-500":t,"border-border_black":x});function pe(t,x){if(t&1){let o=J();s(0,"li")(1,"seven-wonders-scorer-user-card",13),u("openModalEvent",function(r){W(o);let c=K();return q(c.openModal(r))}),n()()}if(t&2){let o=x.$implicit;i(),a("score",o)}}function Se(t,x){t&1&&(s(0,"div",14),l(1," \u30E6\u30FC\u30B6\u30FC\u540D\u3092\u5165\u529B\u3057\u3066\u4E0B\u3055\u3044\u3002 "),n())}var er=(()=>{class t{constructor(o,e,r,c){this.roomService=o,this.formBuilder=e,this.webSocketService=r,this.router=c,this.showModal=!1,this.username="",this.userForm=this.formBuilder.group({username:["",d.required]}),this.formSubmitted=!1,this.roomName="",this.currentUsername="",this.subscription=null}ngOnInit(){let o=localStorage.getItem("roomName"),e=localStorage.getItem("username");if(console.log("roomName:",o),console.log("username:",e),!o||!e){console.error("\u30EB\u30FC\u30E0\u540D\u307E\u305F\u306F\u30E6\u30FC\u30B6\u30FC\u540D\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093"),this.router.navigate(["/login"]);return}this.roomName=o,this.currentUsername=e,this.webSocketService.connect(),this.subscription=this.webSocketService.getConnectionStatus().subscribe(r=>{console.log(r?"WebSocket\u63A5\u7D9A\u6210\u529F":"WebSocket\u5207\u65AD")})}ngOnDestroy(){this.webSocketService.disconnect(),this.subscription&&this.subscription.unsubscribe()}addUser(){if(this.formSubmitted=!0,this.userForm.invalid)return;let o=this.userForm.get("username")?.value;o&&(this.roomService.addUser(o),this.userForm.reset(),this.formSubmitted=!1)}openModal(o){this.showModal=!0,this.username=o}closeModal(){this.showModal=!1,this.username=""}get scores(){return this.roomService.getScores().map(e=>{let c=Math.min(e.scienceScore.compass,e.scienceScore.gear,e.scienceScore.tablet)*7+(e.scienceScore.gear>0?e.scienceScore.gear*e.scienceScore.gear:0)+(e.scienceScore.compass>0?e.scienceScore.compass*e.scienceScore.compass:0)+(e.scienceScore.tablet>0?e.scienceScore.tablet*e.scienceScore.tablet:0),m=e.civilScore+e.militaryScore+c+e.commercialScore+e.guildScore+e.cityScore+e.leaderScore+e.coinScore+e.wonderScore;return y(h({},e),{scienceScore:y(h({},e.scienceScore),{sum:c}),sum:m})})}logout(){localStorage.removeItem("roomName"),localStorage.removeItem("username"),this.webSocketService.disconnect(),this.router.navigate(["/login"])}get isUsernameInvalid(){let o=this.userForm.get("username");return o?o.invalid&&this.formSubmitted:!1}static{this.\u0275fac=function(e){return new(e||t)(p(R),p(B),p(_),p(Z))}}static{this.\u0275cmp=S({type:t,selectors:[["seven-wonders-scorer-score"]],decls:18,vars:11,consts:[[1,"bg-gray-100","p-4","mb-4","rounded-lg","flex","justify-between","items-center"],[1,"text-lg","font-semibold"],[1,"text-sm","text-gray-600"],[1,"bg-red-500","text-white","px-4","py-2","rounded","hover:bg-red-600","transition-colors",3,"click"],[1,"grid","grid-cols-1","desktop:grid-cols-2","gap-2","desktop:gap-4"],[4,"ngFor","ngForOf"],[1,"mt-4",3,"ngSubmit","formGroup"],[1,"flex","flex-col"],[1,"flex","gap-2"],["type","text","formControlName","username","placeholder","\u30E6\u30FC\u30B6\u30FC\u540D\u3092\u5165\u529B","required","",1,"border","border-solid","rounded","p-2","flex-grow","placeholder:text-gray-400",3,"ngClass"],["type","submit",1,"bg-blue-500","text-white","px-4","py-2","rounded","hover:bg-blue-600","transition-colors"],["class","text-red-500 text-sm mt-1",4,"ngIf"],[3,"closeModalEvent","showModal","username"],[3,"openModalEvent","score"],[1,"text-red-500","text-sm","mt-1"]],template:function(e,r){e&1&&(s(0,"div",0)(1,"div")(2,"h2",1),l(3),n(),s(4,"p",2),l(5),n()(),s(6,"button",3),u("click",function(){return r.logout()}),l(7," \u30ED\u30B0\u30A2\u30A6\u30C8 "),n()(),s(8,"ul",4),O(9,pe,2,1,"li",5),n(),s(10,"form",6),u("ngSubmit",function(){return r.addUser()}),s(11,"div",7)(12,"div",8),b(13,"input",9),s(14,"button",10),l(15," \u8FFD\u52A0 "),n()(),O(16,Se,2,0,"div",11),n()(),s(17,"seven-wonders-scorer-score-update-modal",12),u("closeModalEvent",function(){return r.closeModal()}),n()),e&2&&(i(3),v("\u30EB\u30FC\u30E0: ",r.roomName,""),i(2),v("\u30E6\u30FC\u30B6\u30FC\u540D: ",r.currentUsername,""),i(4),a("ngForOf",r.scores),i(),a("formGroup",r.userForm),i(3),a("ngClass",L(8,ue,r.isUsernameInvalid,!r.isUsernameInvalid)),i(3),a("ngIf",r.isUsernameInvalid),i(),a("showModal",r.showModal)("username",r.username))},dependencies:[f,Q,X,Y,D,j,ee,N,I,te,T,U,ae,le],encapsulation:2})}}return t})();export{er as ScoreComponent};
